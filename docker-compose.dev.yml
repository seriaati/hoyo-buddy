# Development Docker Compose Configuration
# Use this for local development with hot-reload
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  bot-main:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder  # Use builder stage for development
    command: python run.py --deployment main
    volumes:
      # Mount source code for hot-reload
      - .:/app
      # Exclude .venv to use container's virtual environment
      - /app/.venv
      - /app/__pycache__
    environment:
      IS_DEV: "true"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - .venv/
            - __pycache__/
            - .git/
            - logs/
            - .cache/
        - action: rebuild
          path: ./pyproject.toml

  bot-sub:
    build:
      target: builder
    command: python run.py --deployment sub
    volumes:
      - .:/app
      - /app/.venv
      - /app/__pycache__
    environment:
      IS_DEV: "true"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - .venv/
            - __pycache__/
        - action: rebuild
          path: ./pyproject.toml

  web-app:
    build:
      target: builder
    command: python run_web_app.py
    volumes:
      - .:/app
      - /app/.venv
    environment:
      IS_DEV: "true"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - .venv/
        - action: rebuild
          path: ./pyproject.toml

  scheduler:
    build:
      target: builder
    command: python run_scheduler.py
    volumes:
      - .:/app
      - /app/.venv
    environment:
      IS_DEV: "true"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - .venv/
        - action: rebuild
          path: ./pyproject.toml

  web-server:
    build:
      target: builder
    command: python run_web_server.py
    volumes:
      - .:/app
      - /app/.venv
    environment:
      IS_DEV: "true"
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - .venv/
        - action: rebuild
          path: ./pyproject.toml
